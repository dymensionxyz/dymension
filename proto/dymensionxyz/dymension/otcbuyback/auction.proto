syntax = "proto3";
package dymensionxyz.dymension.otcbuyback;

import "gogoproto/gogo.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/duration.proto";
import "cosmos/base/v1beta1/coin.proto";
import "cosmos_proto/cosmos.proto";
import "dymensionxyz/dymension/streamer/stream.proto";

option go_package = "github.com/dymensionxyz/dymension/v3/x/otcbuyback/types";

// Auction represents a Dutch auction with decreasing prices over time
message Auction {

  message VestingParams {
    // Vesting period for purchased tokens (e.g., "3 months")
    google.protobuf.Duration vesting_period = 1
        [ (gogoproto.stdduration) = true, (gogoproto.nullable) = false ];

    // Delay before vesting starts after auction ends (e.g., "7 days")
    google.protobuf.Duration vesting_start_after_auction_end = 2
        [ (gogoproto.stdduration) = true, (gogoproto.nullable) = false ];
  }

  // Pump Params defines parameters for the pump streams created after auction
  // completion
  message PumpParams {
    string epoch_identifier = 1;
    uint64 num_epochs = 2;
    uint64 num_of_pumps_per_epoch = 3;
    dymensionxyz.dymension.streamer.PumpDistr pump_distr = 4;
    google.protobuf.Duration start_time_after_auction_end = 5
        [ (gogoproto.stdduration) = true, (gogoproto.nullable) = false ];
  }

  // Unique identifier for the auction
  uint64 id = 1;

  bool completed = 2;

  // Total adym allocation for the auction
  string allocation = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];

  // Start time of the auction
  google.protobuf.Timestamp start_time = 4
      [ (gogoproto.stdtime) = true, (gogoproto.nullable) = false ];

  // End time of the auction
  google.protobuf.Timestamp end_time = 5
      [ (gogoproto.stdtime) = true, (gogoproto.nullable) = false ];

  // Initial discount percentage (e.g., "0.05" for 5%)
  string initial_discount = 6 [
    (cosmos_proto.scalar) = "cosmos.Dec",
    (gogoproto.customtype) = "cosmossdk.io/math.LegacyDec",
    (gogoproto.nullable) = false
  ];

  // Maximum discount percentage (e.g., "0.50" for 50%)
  string max_discount = 7 [
    (cosmos_proto.scalar) = "cosmos.Dec",
    (gogoproto.customtype) = "cosmossdk.io/math.LegacyDec",
    (gogoproto.nullable) = false
  ];

  // Total amount of tokens already sold
  string sold_amount = 8 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false
  ];

  // Total raised amount in all accepted tokens
  repeated cosmos.base.v1beta1.Coin raised_amount = 9 [
    (gogoproto.nullable) = false,
    (gogoproto.castrepeated) = "github.com/cosmos/cosmos-sdk/types.Coins"
  ];

  // The vesting params for purchased tokens in the auction
  VestingParams vesting_params = 10 [ (gogoproto.nullable) = false ];

  // Pump params to be used for pump streams after auction completion
  PumpParams pump_params = 11 [ (gogoproto.nullable) = false ];
}
